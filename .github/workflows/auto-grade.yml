name: Autograding Tests

on:
  - push
  - repository_dispatch

permissions:
  checks: write
  actions: read
  contents: read

jobs:
  run-autograding-tests:
    runs-on: ubuntu-latest
    if: github.actor != 'github-classroom[bot]'
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: "3.9"

      - name: Install dependencies
        id: Install
        run: |
          python -m pip install --upgrade pip
          pip install pytest subprocess

      - name: Question 1
        id: Q1
        run: pytest .github/test/test_1.py -v --tb=short
        continue-on-error: true

      - name: Question 2
        id: Q2
        run: pytest .github/test/test_2.py -v --tb=short
        continue-on-error: true

      - name: Question 3
        id: Q3
        run: pytest .github/test/test_3.py -v --tb=short
        continue-on-error: true

      - name: Question 4
        id: Q4
        run: pytest .github/test/test_4.py -v --tb=short
        continue-on-error: true

      - name: Autograding Reporter
        uses: classroom-resources/autograding-grading-reporter@v1
        env:
          QUESTION_1_RESULTS: "${{ steps.Q1.outcome }}"
          QUESTION_2_RESULTS: "${{ steps.Q2.outcome }}"
          QUESTION_3_RESULTS: "${{ steps.Q3.outcome }}"
          QUESTION_4_RESULTS: "${{ steps.Q4.outcome }}"
        with:
          runners: [Install, Q1, Q2, Q3, Q4]
